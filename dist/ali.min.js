/*!
 * --------------------------------------------------------------------------
 * Ali - Accessible Learning Interactions (
 * Copyright 2016 Jer Brand / Irresponsible Art
 * Licensed GPL (https://github.com/aut0poietic/ali/blob/master/LICENSE)
 * --------------------------------------------------------------------------
 */
"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}jQuery(function(a){window.aliAutolInit!==!1&&a('[data-ali="accordion"]').accordion()});var ali={EVENT:{ready:"ali:ready",complete:"ali:complete"},STATUS:{complete:"complete",correct:"correct",incorrect:"incorrect",unanticipated:"unanticipated",incomplete:"incomplete"},TYPE:{choice:"choice",performance:"performance",sequencing:"sequencing",numeric:"numeric",other:"other"}},ARIA=function(a){function b(a){return a=(""+a).toLowerCase().trim(),"role"!==a&&"tabindex"!==a?"aria-"+a:a}function c(a){return d.indexOf(a)>-1}var d=["role","tabindex","activedescendant","atomic","autocomplete","busy","checked","controls","describedby","disabled","dropeffect","expanded","flowto","grabbed","haspopup","hidden","invalid","label","labelledby","level","live","multiline","multiselectable","orientation","owns","posinset","pressed","readonly","relevant","required","selected","setsize","sort","valuemax","valuemin","valuenow","valuetext"];a.fn.aria=function(d,e){if("object"===a.type(d))for(var f in d)d.hasOwnProperty(f)&&this.aria(f,d[f]);else if(void 0!==d&&void 0!==e)this.each(function(){if(c(d)){var f=a(this),g=b(d);f.attr(g,e)}});else if(void 0!==d)return this.attr(b(d));return this}}(jQuery),_createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),aliInteraction=function(){function a(b){var c=arguments.length<=1||void 0===arguments[1]?ali.TYPE.other:arguments[1],d=arguments.length<=2||void 0===arguments[2]?"Ali Interaction":arguments[2];_classCallCheck(this,a),this.$el=$(b);var e=new Date;this._data={id:this.$el.attr("id"),start:e.getTime(),type:c,correct_responses:[],learner_response:[],result:ali.STATUS.incomplete,latency:0,description:d}}return _createClass(a,[{key:"makeTargetID",value:function(a){var b=a.attr("id");return void 0===b?(b=a.text().replace(/[\W_]+/g,"").toLowerCase(),b.length>10&&(b=b.substring(0,10))):b+="-target",b}},{key:"defer",value:function(a){var b=function(){a.apply(this)};requestAnimationFrame(b.bind(this))}},{key:"complete",value:function(){var a=arguments.length<=0||void 0===arguments[0]?"complete":arguments[0],b=new Date;this.data.result=a,this.data.latency=b.getTime()-this.data.start;var c=new jQuery.Event("ali:complete");this.$el.trigger(c,[this.data])}},{key:"data",get:function(){return this._data}},{key:"learnerResponses",set:function(a){"array"===$.getType(a)&&(this.data.learner_response=a)}},{key:"correctResponses",set:function(a){"array"===$.getType(a)&&(this.data.correct_responses=a)}}]),a}(),_createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),aliMultipartInteraction=function(a){function b(a){var c=arguments.length<=1||void 0===arguments[1]?ali.TYPE.other:arguments[1],d=arguments.length<=2||void 0===arguments[2]?"Ali Interaction":arguments[2];_classCallCheck(this,b);var e=_possibleConstructorReturn(this,Object.getPrototypeOf(b).call(this,a,c,d));return e.lastPartEnd=e.data.start,e}return _inherits(b,a),_createClass(b,[{key:"itemSelected",value:function(a){var b=new jQuery.Event("ali:itemSelected");this.$el.trigger(b,[this.data,a])}},{key:"itemComplete",value:function(){var a=arguments.length<=0||void 0===arguments[0]?ali.STATUS.complete:arguments[0],b=arguments.length<=1||void 0===arguments[1]?this.$el:arguments[1],c=Object.assign({},this.data),d=new Date;c.result=a,c.latency=d.getTime()-this.lastPartEnd;var e=new jQuery.Event("ali:itemComplete");this.$el.trigger(e,[c,b]),this.lastPartEnd=d.getTime()}}]),b}(aliInteraction),_createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),aliAccordion=function(a){var b="Accordion interaction.",c=ali.TYPE.other,d=".accordion-tab",e='.accordion-tab[aria-expanded="true"]',f=".accordion-panel",g=function(g){function h(g){_classCallCheck(this,h);var i=_possibleConstructorReturn(this,Object.getPrototypeOf(h).call(this,g,c,b));i.$el.aria({role:"tablist",multiselectable:"true"}),i.$tabs=a(d,i.$el);var j=a(e);return i.$tabs.each(function(b,c){var d=a(c),e=i.makeTargetID(d),g=d.next(f);d.aria({role:"tab",tabindex:"0",expanded:"false",controls:e}).off("click.ali").on("click.ali",i.tab_onClick.bind(i)).off("keydown.ali").on("keydown.ali",i.tab_onKeyDown.bind(i)),g.aria({role:"tabpanel",tabindex:"-1",hidden:"true"}).attr({id:e,"data-height":i._getMeasuredHeight(g)}).off("keydown.ali").on("keydown.ali",i.panel_onKeyDown.bind(i))}),j.length>0?i.defer(function(){i.show(a(j[0]))}):i.getFirstTab().aria("tabindex",0),a(window).on("resize",i.requestResize.bind(i)),i}return _inherits(h,g),_createClass(h,[{key:"hide",value:function(a){this.getPanelFromTab(a).aria({hidden:"true",tabindex:"-1"}).removeAttr("style"),a.aria("expanded","false")}},{key:"hideAll",value:function(){var b=this;this.$tabs.each(function(c,d){b.hide(a(d))})}},{key:"show",value:function(b){var c=this.getPanelFromTab(b),d=parseInt(c.attr("data-height"));this.hideAll(),c.aria({hidden:"false",tabindex:"0"}),d>0&&c.css("max-height",d+"px"),b.aria({expanded:"true",selected:"true",tabindex:"0"}).addClass("viewed").focus(),this.itemSelected(b),a(".viewed",this.$el).length===this.$tabs.length&&this.data.status===ali.STATUS.incomplete&&this.complete()}},{key:"getPanelFromTab",value:function(b){return a("#"+b.aria("controls"))}},{key:"getTabFromPanel",value:function(b){return a(d+'[aria-controls="'+b.attr("id")+'"]')}},{key:"_nextTab",value:function(a){for(var b=a.next(),c=2*this.$tabs.length;b.length>0&&!b.is(d)&&0!=c--;)b=b.next();return b}},{key:"getNextTab",value:function(a){var b=this._nextTab(a);return 0===b.length?this.getFirstTab():b}},{key:"_previousTab",value:function(a){for(var b=a.prev(),c=2*this.$tabs.length;b.length>0&&!b.is(d)&&0!=c--;)b=b.prev();return b}},{key:"getPreviousTab",value:function(a){var b=this._previousTab(a);return 0===b.length?this.getLastTab():b}},{key:"getFirstTab",value:function(){return this.$tabs.first()}},{key:"getLastTab",value:function(){return this.$tabs.last()}},{key:"tab_onKeyDown",value:function(b){switch(b.which){case 13:case 32:b.preventDefault(),b.stopPropagation(),this.tab_onClick(b);break;case 37:case 38:b.preventDefault(),b.stopPropagation(),this.show(this.getPreviousTab(a(b.currentTarget)));break;case 39:case 40:b.preventDefault(),b.stopPropagation(),this.show(this.getNextTab(a(b.currentTarget)));break;case 35:b.preventDefault(),b.stopPropagation(),this.show(this.getLastTab());break;case 36:b.preventDefault(),b.stopPropagation(),this.show(this.getFirstTab())}}},{key:"tab_onClick",value:function(b){var c=a(b.target);"true"!==c.aria("expanded")?(this.hideAll(),this.show(c)):this.hide(c)}},{key:"panel_onKeyDown",value:function(b){if((b.ctrlKey||b.metaKey)&&b.currentTarget){var c,d=a(b.currentTarget);switch(b.which){case 38:b.preventDefault(),b.stopPropagation(),this.getTabFromPanel(d).focus();break;case 33:b.preventDefault(),b.stopPropagation(),c=this.getFirstTab(),"false"===c.aria("expanded")&&this.show(c),c.focus();break;case 40:b.preventDefault(),b.stopPropagation(),c=this.getLastTab(),"false"===c.aria("expanded")&&this.show(c),c.focus()}}}},{key:"onResize",value:function(b){this._width=a(document).width(),this._requestResize()}},{key:"_requestResize",value:function(){this._resizing||(requestAnimationFrame(this._resizePanels.bind(this)),this._resizing=!0)}},{key:"_resizePanels",value:function(){var b=this;this.$tabs.each(function(c,d){var e=a(d).next(f);e.attr("data-height",b._getMeasuredHeight(e)),"false"===e.aria("hidden")&&e.css("min-height",b._getMeasuredHeight(e)+"px")}),this._resizing=!1}},{key:"_getMeasuredHeight",value:function(b){var c=a('<div id="ali-temp" aria-hidden="true" style="overflow:hidden;height:1px;width:100%;visibility: hidden"></div>').appendTo(this.$el),d=a('<dd class="accordion-panel"></dd>').html(b.html()).appendTo(c),e=d.height();return c.remove(),e}}],[{key:"_jQuery",value:function(){return this.each(function(){new h(this)})}}]),h}(aliMultipartInteraction);return a.fn.accordion=g._jQuery,a.fn.accordion.Constructor=g,a.fn.accordion.noConflict=function(){return a.fn.accordion=a.fn.accordion,g._jQuery},g}(jQuery);
//# sourceMappingURL=ali.min.js.map