/*!
 * --------------------------------------------------------------------------
 * Ali - Accessible Learning Interactions (
 * Copyright 2016 Jer Brand / Irresponsible Art
 * Licensed GPL (https://github.com/aut0poietic/ali/blob/master/LICENSE)
 * --------------------------------------------------------------------------
 */
window.ali={EVENT:{ready:"ali:ready",complete:"ali:complete"},STATUS:{complete:"complete",correct:"correct",incorrect:"incorrect",unanticipated:"unanticipated",incomplete:"incomplete"},TYPE:{choice:"choice",performance:"performance",sequencing:"sequencing",numeric:"numeric",other:"other"},Interaction:null},jQuery(function(a){"use strict";window.aliAutolInit!==!1&&(a('[data-ali="accordion"]').accordion(),a('[data-ali="tab-control"]').tabcontrol())}),function(a){"use strict";function b(a){return a=(""+a).toLowerCase().trim(),"role"!==a&&"tabindex"!==a?"aria-"+a:a}function c(a){return d.indexOf(a)>-1}var d=["role","tabindex","activedescendant","atomic","autocomplete","busy","checked","controls","describedby","disabled","dropeffect","expanded","flowto","grabbed","haspopup","hidden","invalid","label","labelledby","level","live","multiline","multiselectable","orientation","owns","posinset","pressed","readonly","relevant","required","selected","setsize","sort","valuemax","valuemin","valuenow","valuetext"];a.fn.aria=function(d,e){if("object"===a.type(d))for(var f in d)d.hasOwnProperty(f)&&this.aria(f,d[f]);else if(void 0!==d&&void 0!==e)this.each(function(){if(c(d)){var f=a(this),g=b(d);f.attr(g,e)}});else if(void 0!==d)return this.attr(b(d));return this}}(jQuery),function(a){"use strict";var b=window.ali;"object"===a.type(b)&&(b.Interaction=function(b,c,d){this.$el=a(b),"string"===a.type(c)&&(this.data.type=c),"string"===a.type(d)&&(this.data.description=d)},b.Interaction.prototype.data={id:"",start:0,type:b.TYPE.other,correct_responses:[],learner_response:[],result:b.STATUS.incomplete,latency:0,description:"Ali Interaction"},b.Interaction.prototype.__last=0,b.Interaction.prototype.makeTargetID=function(a){var b=a.attr("id");return void 0===b?(b=a.text().replace(/[\W_]+/g,"").toLowerCase(),b.length>10&&(b=b.substring(0,10))):b+="-target",b},b.Interaction.prototype.defer=function(a){var b=function(){a.apply(this)};requestAnimationFrame(b.bind(this))},b.Interaction.prototype.setLearnerResponses=function(b){"array"===a.type(b)&&(this.data.learner_response=b)},b.Interaction.prototype.setCorrectResponses=function(b){"array"===a.type(b)&&(this.data.correct_responses=b)},b.Interaction.prototype.complete=function(b){var c,d=new Date;"undefined"!==a.type(b)&&""!==b.trim()||(b="complete"),this.data.result=b,this.data.latency=d.getTime()-this.data.start,c=new jQuery.Event("ali:complete"),this.$el.trigger(c,[this.data])},b.Interaction.prototype.itemSelected=function(a){var b=new jQuery.Event("ali:itemSelected");this.$el.trigger(b,[this.data,a])},b.Interaction.prototype.itemComplete=function(c,d){"undefined"!==a.type(c)&&""!==c.trim()||(c=b.STATUS.complete),"undefined"!==a.type(d)&&0!==d.length||(d=this.$el);var e=Object.assign({},this.data),f=new Date,g=new jQuery.Event("ali:itemComplete");e.result=c,e.latency=f.getTime()-this.__last,this.__last=f.getTime(),this.$el.trigger(g,[e,d])})}(jQuery),function(a){"use strict";function b(){return this.each(function(){new c.Accordion(this)})}var c=window.ali;if("object"===a.type(c)){var d="Accordion interaction.",e=c.TYPE.other,f=".accordion-tab",g='.accordion-tab[aria-expanded="true"]',h=".accordion-panel";c.Accordion=function(a){c.Interaction.call(this,a,e,d),this.init()},c.Accordion.prototype=Object.create(c.Interaction.prototype),c.Accordion.prototype.constructor=c.Accordion,c.Accordion.prototype.$tabs=void 0,c.Accordion.prototype.init=function(){var b=a(g);this.$tabs=a(f,this.$el),this.$tabs.each(this.initTab.bind(this)),b.length>0?this.defer(function(){this.show(a(b[0]))}.bind(this)):this.getFirstTab().aria("tabindex",0),a(window).on("resize",this._requestResize.bind(this))},c.Accordion.prototype.initTab=function(b,c){var d,e,f;d=a(c),f=this.makeTargetID(d),e=d.next(h),d.aria({role:"tab",tabindex:"0",expanded:"false",controls:f}).off("click.ali").on("click.ali",this.tab_onClick.bind(this)).off("keydown.ali").on("keydown.ali",this.tab_onKeyDown.bind(this)),e.aria({role:"tabpanel",tabindex:"-1",hidden:"true"}).attr({id:f,"data-height":this._getMeasuredHeight(e)}).off("keydown.ali").on("keydown.ali",this.panel_onKeyDown.bind(this))},c.Accordion.prototype.hide=function(a){this.getPanelFromTab(a).aria({hidden:"true",tabindex:"-1"}).removeAttr("style"),a.aria("expanded","false")},c.Accordion.prototype.hideAll=function(){this.$tabs.each(function(b,c){this.hide(a(c))}.bind(this))},c.Accordion.prototype.show=function(b){var d=this.getPanelFromTab(b),e=parseInt(d.attr("data-height"));this.hideAll(),d.aria({hidden:"false",tabindex:"0"}),e>0&&d.css("max-height",e+"px"),b.aria({expanded:"true",tabindex:"0"}).addClass("viewed").focus(),this.itemSelected(b),a(".viewed",this.$el).length===this.$tabs.length&&this.data.result===c.STATUS.incomplete&&this.complete()},c.Accordion.prototype.getPanelFromTab=function(b){return a("#"+b.aria("controls"))},c.Accordion.prototype.getTabFromPanel=function(b){return a(f+'[aria-controls="'+b.attr("id")+'"]')},c.Accordion.prototype._nextTab=function(a){for(var b=a.next(),c=2*this.$tabs.length;b.length>0&&!b.is(f)&&0!==c--;)b=b.next();return b},c.Accordion.prototype.getNextTab=function(a){var b=this._nextTab(a);return 0===b.length?this.getFirstTab():b},c.Accordion.prototype._previousTab=function(a){for(var b=a.prev(),c=2*this.$tabs.length;b.length>0&&!b.is(f)&&0!==c--;)b=b.prev();return b},c.Accordion.prototype.getPreviousTab=function(a){var b=this._previousTab(a);return 0===b.length?this.getLastTab():b},c.Accordion.prototype.getFirstTab=function(){return this.$tabs.first()},c.Accordion.prototype.getLastTab=function(){return this.$tabs.last()},c.Accordion.prototype.tab_onKeyDown=function(b){switch(b.which){case 13:case 32:b.preventDefault(),b.stopPropagation(),this.tab_onClick(b);break;case 37:case 38:b.preventDefault(),b.stopPropagation(),this.show(this.getPreviousTab(a(b.currentTarget)));break;case 39:case 40:b.preventDefault(),b.stopPropagation(),this.show(this.getNextTab(a(b.currentTarget)));break;case 35:b.preventDefault(),b.stopPropagation(),this.show(this.getLastTab());break;case 36:b.preventDefault(),b.stopPropagation(),this.show(this.getFirstTab())}},c.Accordion.prototype.tab_onClick=function(b){var c=a(b.target);"true"!==c.aria("expanded")?this.show(c):this.hide(c)},c.Accordion.prototype.panel_onKeyDown=function(b){if((b.ctrlKey||b.metaKey)&&b.currentTarget){var c,d=a(b.currentTarget);switch(b.which){case 38:b.preventDefault(),b.stopPropagation(),this.getTabFromPanel(d).focus();break;case 33:b.preventDefault(),b.stopPropagation(),c=this.getFirstTab(),"false"===c.aria("expanded")&&this.show(c),c.focus();break;case 40:b.preventDefault(),b.stopPropagation(),c=this.getLastTab(),"false"===c.aria("expanded")&&this.show(c),c.focus()}}},c.Accordion.prototype.onResize=function(b){this._width=a(document).width(),this._requestResize()},c.Accordion.prototype._requestResize=function(){this._resizing||(requestAnimationFrame(this._resizePanels.bind(this)),this._resizing=!0)},c.Accordion.prototype._resizePanels=function(){this.$tabs.each(function(b,c){var d=a(c).next(h);d.attr("data-height",this._getMeasuredHeight(d)),"false"===d.aria("hidden")&&d.css("min-height",this._getMeasuredHeight(d)+"px")}.bind(this)),this._resizing=!1},c.Accordion.prototype._getMeasuredHeight=function(b){var c=a('<div id="ali-temp" aria-hidden="true" style="overflow:hidden;height:1px;width:100%;visibility: hidden"></div>').appendTo(this.$el),d=a('<dd class="accordion-panel"></dd>').html(b.html()).appendTo(c),e=d.height();return c.remove(),e};var i=a.fn.accordion;a.fn.accordion=b,a.fn.accordion.Constructor=c.Accordion,a.fn.accordion.noConflict=function(){return a.fn.accordion=i,this}}}(jQuery),function(a){"use strict";function b(){return this.each(function(){new c.TabControl(this)})}var c=window.ali;if("object"===a.type(c)){var d="Tab Control interaction.",e=c.TYPE.other,f=".tab-control-tablist",g=f+" li",h=g+'[aria-selected="true"]',i=".tab-control-panel";c.TabControl=function(a){c.Interaction.call(this,a,e,d),this.init()},c.TabControl.prototype=Object.create(c.Interaction.prototype),c.TabControl.prototype.constructor=c.Accordion,c.Accordion.prototype.$tabs=void 0,c.Accordion.prototype.$vi=void 0,c.TabControl.prototype.init=function(){this.createTabs()},c.TabControl.prototype.createTabs=function(){var b=a(f,this.$el);this.$tabs=a(g,this.$el);var c=a(h,this.$el),d=a(i,this.$el),e=this.$el.attr("id");d.each(function(b,c){var d=a(c);d.attr("id",e+"-panel-"+b).aria({role:"tabpanel",hidden:"true",tabindex:"-1",labeledby:e+"-tab-"+b}).off("keydown.ali").on("keydown.ali",this.panel_onKeyDown.bind(this))}.bind(this)),b.aria({role:"tablist",hidden:"true"}),this.$tabs.each(function(b,c){var d=a(c);d.attr("id",e+"-tab-"+b).aria({role:"tab",controls:e+"-panel-"+b,tabindex:"-1",selected:"false"}).off("click.ali").on("click.ali",this.tab_onClick.bind(this)).off("keydown.ali").on("keydown.ali",this.tab_onKeyDown.bind(this))}.bind(this)),this.$vi=a('<span class="vi" role="presentation"></span>'),b.append(this.$vi),c=a(c.length>0?c[0]:this.$tabs[0]),this.defer(function(){b.aria("hidden","false"),this.show(c)}.bind(this))},c.TabControl.prototype.hide=function(a){this.getPanelFromTab(a).aria({hidden:"true",tabindex:"-1"}),a.aria({selected:"false",tabindex:"-1"})},c.TabControl.prototype.hideAll=function(){this.$tabs.each(function(b,c){this.hide(a(c))}.bind(this))},c.TabControl.prototype.show=function(b){var d=this.getPanelFromTab(b);this.hideAll(),d.aria({hidden:"false",tabindex:"0"}),b.aria({selected:"true",tabindex:"0"}).addClass("viewed").focus(),this.itemSelected(b);var e=b.position(),f=b.outerWidth();this.$vi.css({width:f+"px",left:e.left+"px"}),a(".viewed",this.$el).length===this.$tabs.length&&this.data.result===c.STATUS.incomplete&&this.complete()},c.TabControl.prototype.getPanelFromTab=function(b){return a("#"+b.aria("controls"))},c.TabControl.prototype.getTabFromPanel=function(b){return a(g+'[aria-controls="'+b.attr("id")+'"]')},c.TabControl.prototype._nextTab=function(a){for(var b=a.next(),c=2*this.$tabs.length;b.length>0&&!b.is(g)&&0!==c--;)b=b.next();return b},c.TabControl.prototype.getNextTab=function(a){var b=this._nextTab(a);return 0===b.length?this.getFirstTab():b},c.TabControl.prototype._previousTab=function(a){for(var b=a.prev(),c=2*this.$tabs.length;b.length>0&&!b.is(g)&&0!==c--;)b=b.prev();return b},c.TabControl.prototype.getPreviousTab=function(a){var b=this._previousTab(a);return 0===b.length?this.getLastTab():b},c.TabControl.prototype.getFirstTab=function(){return this.$tabs.first()},c.TabControl.prototype.getLastTab=function(){return this.$tabs.last()},c.TabControl.prototype.panel_onKeyDown=function(b){if((b.ctrlKey||b.metaKey)&&b.currentTarget){var c,d=a(b.currentTarget);switch(b.which){case 38:b.preventDefault(),b.stopPropagation(),this.getTabFromPanel(d).focus();break;case 33:b.preventDefault(),b.stopPropagation(),c=this.getFirstTab(),"false"===c.aria("expanded")&&this.show(c),c.focus();break;case 40:b.preventDefault(),b.stopPropagation(),c=this.getLastTab(),"false"===c.aria("expanded")&&this.show(c),c.focus()}}},c.TabControl.prototype.tab_onClick=function(b){var c=a(b.target);"true"!==c.aria("selected")&&(this.hideAll(),this.show(c)),console.log(c.aria("selected"))},c.TabControl.prototype.tab_onKeyDown=function(b){switch(b.which){case 13:case 32:b.preventDefault(),b.stopPropagation(),this.tab_onClick(b);break;case 37:case 38:b.preventDefault(),b.stopPropagation(),this.show(this.getPreviousTab(a(b.currentTarget)));break;case 39:case 40:b.preventDefault(),b.stopPropagation(),this.show(this.getNextTab(a(b.currentTarget)));break;case 35:b.preventDefault(),b.stopPropagation(),this.show(this.getLastTab());break;case 36:b.preventDefault(),b.stopPropagation(),this.show(this.getFirstTab())}};var j=a.fn.tabcontrol;a.fn.tabcontrol=b,a.fn.tabcontrol.Constructor=c.TabControl,a.fn.tabcontrol.noConflict=function(){return a.fn.tabcontrol=j,this}}}(jQuery);
//# sourceMappingURL=ali.min.js.map